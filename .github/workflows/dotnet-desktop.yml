name: PR AutomÃ¡tica com GitHub CLI ğŸ’œ

on:
  push:
    branches:
      - "feature/**"

jobs:
  criar-pr:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ”„ Checkout do repositÃ³rio
        uses: actions/checkout@v4

      - name: ğŸ§ª Verifica se gh CLI estÃ¡ disponÃ­vel
        run: |
          if ! command -v gh &> /dev/null; then
            echo "ğŸ”§ Instalando GitHub CLI..."
            sudo apt update && sudo apt install gh -y
          else
            echo "âœ… GitHub CLI jÃ¡ estÃ¡ disponÃ­vel."
          fi

      - name: âœ¨ Cria Pull Request automaticamente
        run: |
          echo "ğŸ” Branch atual: ${{ github.ref_name }}"
          echo "ğŸ“¬ Criando PR da branch '${{ github.ref_name }}' para 'main'..."

          gh pr list --head "$(echo '${{ github.ref }}' | sed 's/refs\/heads\///')" --json number

          gh pr create \
            --title "âœ¨ PR automÃ¡tica: ${{ github.ref_name }}" \
            --body "Essa Pull Request foi gerada automaticamente apÃ³s push na branch `${{ github.ref_name }}`." \
            --base main \
            --head "$(echo '${{ github.ref }}' | sed 's/refs\/heads\///')"
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
